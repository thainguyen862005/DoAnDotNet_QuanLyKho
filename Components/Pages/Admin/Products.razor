    @page "/admin/products"
    @rendermode InteractiveServer
    @layout AdminLayout

    <div class="container-fluid px-4">
        <div class="d-flex justify-content-between align-items-center mt-4 mb-4">
            <div>
                <h2 class="fw-bold mb-0">Qu·∫£n l√Ω s·∫£n ph·∫©m</h2>
                <p class="text-muted">Danh s√°ch s·∫£n ph·∫©m (D·ªØ li·ªáu m·∫´u)</p>
            </div>
            <button type="button" class="btn btn-success px-4 py-2 fw-bold" @onclick="OpenAddModal">
            <i class="bi bi-plus-circle"></i> + Th√™m s·∫£n ph·∫©m</button>
        </div>

        <div class="card border-0 shadow-sm mb-4">
            <div class="card-body p-2">
                <div class="input-group border-0">
                    <span class="input-group-text bg-white border-0 text-muted">üîç</span>
                    <input class="form-control border-0 shadow-none"
                   placeholder=" T√¨m theo t√™n, SKU, h√£ng..."
                   @bind="SearchTerm"
                   @bind:event="oninput" />
                </div>
            </div>
        </div>

        <div class="card border-0 shadow-sm overflow-hidden">
            <table class="table table-hover align-middle mb-0">
                <thead class="bg-light">
                    <tr class="text-secondary small fw-bold text-uppercase" style="font-size: 11px;">
                        <th class="ps-4 py-3">S·∫£n ph·∫©m</th>
                        <th>SKU</th>
                        <th>Danh m·ª•c</th>
                        <th class="text-end">Gi√°</th>
                        <th class="text-center">T·ªìn kho</th>
                        <th class="text-center">Tr·∫°ng th√°i</th>
                        <th class="text-end pe-4">Thao t√°c</th>
                    </tr>
                </thead>
                <tbody>
                    @if (FilteredProducts.Any())
                    {
                        @foreach (var prod in FilteredProducts)
                        {
                            <tr @key="prod.Id">
                                <td class="ps-4">
                                    <div class="fw-bold">@prod.Name</div>
                                    <small class="text-muted text-uppercase">Dung l∆∞·ª£ng: @prod.Storage</small>
                                </td>
                                <td class="text-muted">@prod.SKU</td>
                                <td>
                                    <span class="badge rounded-pill px-3 py-2 @GetBrandBadgeClass(prod.Brand)">
                                        @prod.Brand
                                    </span>
                                </td>
                                <td class="text-end fw-bold text-primary">@prod.Price.ToString("N0")ƒë</td>
                                <td class="text-center">
                                    <span class="@(prod.Stock < 5 ? "text-danger fw-bold" : "")">
                                        @prod.Stock m√°y
                                    </span>
                                </td>
                                <td class="text-center">
                                    @if (prod.Stock > 0)
                                    {
                                        <span class="badge rounded-pill px-3 py-2" style="background-color: #e6f7ed; color: #10b981;">S·∫µn h√†ng</span>
                                    }
                                    else
                                    {
                                        <span class="badge rounded-pill px-3 py-2 bg-danger-subtle text-danger">H·∫øt h√†ng</span>
                                    }
                                </td>
                                 <td class="text-end pe-4">
                                <button type="button"
                                    class="btn btn-sm"
                                    title="S·ª≠a"
                                    @onclick="() => OpenEditModal(prod)">
                                   ‚úèÔ∏è
                                </button>
                               <button type="button"
                                    class="btn btn-sm"
                                    title="X√≥a"
                                    @onclick="() => ConfirmDelete(prod)">
                                    üóëÔ∏è
                                </button>
                            </td>
                            </tr>
                        }
                    }
                    else
                    {
                        <tr>
                        <td colspan="7" class="text-center py-5 text-muted">
                            <img src="https://cdn-icons-png.flaticon.com/512/4076/4076549.png"
                                 width="50" class="mb-2 opacity-50" />
                            <div>Kh√¥ng c√≥ s·∫£n ph·∫©m</div>
                        </td>
                    </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>
   @if (IsShowModal)
{
    <div class="modal fade show d-block"
         style="background:rgba(0,0,0,.5); z-index:1050"
         aria-modal="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="fw-bold">
                        @(IsEdit ? "S·ª≠a s·∫£n ph·∫©m" : "Th√™m s·∫£n ph·∫©m")
                    </h5>
                    <button class="btn-close" @onclick="CloseModal"></button>
                </div>
                <div class="modal-body">

                    <div class="mb-3">
                        <label class="form-label">T√™n</label>
                        <input class="form-control"
                               @bind="EditingProduct.Name" />
                    </div>

                    <div class="row">
                        <div class="col-6 mb-3">
                            <label>H√£ng</label>
                            <select class="form-select"
                                    @bind="EditingProduct.Brand">
                                <option>Apple</option>
                                <option>Samsung</option>
                                <option>Xiaomi</option>
                                <option>Oppo</option>
                                <option>Google</option>
                            </select>
                        </div>
                        <div class="col-6 mb-3">
                            <label>Dung l∆∞·ª£ng</label>
                            <input class="form-control"
                                   @bind="EditingProduct.Storage" />
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-6 mb-3">
                            <label>Gi√°</label>
                            <input type="number"
                                   class="form-control"
                                   @bind="EditingProduct.Price" />
                        </div>
                        <div class="col-6 mb-3">
                            <label>Kho</label>
                            <input type="number"
                                   class="form-control"
                                   @bind="EditingProduct.Stock" />
                        </div>
                    </div>

                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary"
                            @onclick="CloseModal">
                        H·ªßy
                    </button>
                    <button class="btn btn-success"
                            @onclick="SaveProduct">
                        L∆∞u
                    </button>
                </div>
            </div>
        </div>
    </div>
}
@if (ShowDeleteConfirm)
{
    <div class="modal fade show d-block"
         style="background:rgba(0,0,0,.5)">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-body text-center">
                    <h5 class="fw-bold mb-3">X√≥a s·∫£n ph·∫©m?</h5>
                    <p class="text-muted">@DeletingProduct?.Name</p>
                    <button class="btn btn-danger me-2"
                            @onclick="DeleteProduct">
                        X√≥a
                    </button>
                    <button class="btn btn-secondary"
                            @onclick="() => ShowDeleteConfirm = false">
                        H·ªßy
                    </button>
                </div>
            </div>
        </div>
    </div>
}

    @code {
    public class Product
    {
        public int Id { get; set; }
        public string Name { get; set; } = "";
        public string SKU { get; set; } = "";
        public string Brand { get; set; } = "";
        public string Storage { get; set; } = "";
        public decimal Price { get; set; }
        public int Stock { get; set; }
    }

     private string SearchTerm = "";
    private bool IsShowModal;
    private bool IsEdit;
    private bool ShowDeleteConfirm;

    private Product EditingProduct = new();
    private Product? DeletingProduct;    
    private List<Product> products = new List<Product>
    {
        new Product { Id = 1, Name = "iPhone 17 Pro Max", SKU = "IP17-PM-256", Brand = "Apple", Storage = "256GB", Price = 32990000, Stock = 15 },
        new Product { Id = 2, Name = "Samsung Galaxy S26 Ultra", SKU = "SS-S26U-512", Brand = "Samsung", Storage = "512GB", Price = 29500000, Stock = 8 },
        new Product { Id = 3, Name = "Xiaomi 16 Pro", SKU = "XI-16P-256", Brand = "Xiaomi", Storage = "256GB", Price = 18900000, Stock = 0 },
        new Product { Id = 4, Name = "Oppo Find X9", SKU = "OP-X9-128", Brand = "Oppo", Storage = "128GB", Price = 15500000, Stock = 24 },
        new Product { Id = 5, Name = "Google Pixel 10", SKU = "GG-P10-256", Brand = "Google", Storage = "256GB", Price = 21000000, Stock = 3 }
    };
   
    private List<Product> FilteredProducts => products
        .Where(p => string.IsNullOrWhiteSpace(SearchTerm) || 
                    p.Name.Contains(SearchTerm, StringComparison.OrdinalIgnoreCase) || 
                    p.SKU.Contains(SearchTerm, StringComparison.OrdinalIgnoreCase) ||
                    p.Brand.Contains(SearchTerm, StringComparison.OrdinalIgnoreCase))
        .ToList(); 

    private void OpenAddModal()
    {
        EditingProduct = new Product();
        IsEdit = false;
        IsShowModal = true;
    }

   private void OpenEditModal(Product p)
{
    EditingProduct = new Product
    {
        Id = p.Id,
        Name = p.Name,
        SKU = p.SKU,
        Brand = p.Brand,
        Storage = p.Storage,
        Price = p.Price,
        Stock = p.Stock
    };

    IsEdit = true;
    IsShowModal = true;

    StateHasChanged(); 
}
    private void SaveProduct()
    {
        if (string.IsNullOrWhiteSpace(EditingProduct.Name)) return;

        if (IsEdit)
        {
            var p = products.First(x => x.Id == EditingProduct.Id);
            p.Name = EditingProduct.Name;
            p.Brand = EditingProduct.Brand;
            p.Storage = EditingProduct.Storage;
            p.Price = EditingProduct.Price;
            p.Stock = EditingProduct.Stock;
        }
        else
        {
            EditingProduct.Id = products.Max(p => p.Id) + 1;
            EditingProduct.SKU = $"TEL-{DateTime.Now.Ticks % 100000}";
            products.Add(EditingProduct);
        }

        IsShowModal = false;
    }

    private void ConfirmDelete(Product p)
    {
        DeletingProduct = p;
        ShowDeleteConfirm = true;
    }

    private void DeleteProduct()
    {
        if (DeletingProduct != null)
            products.Remove(DeletingProduct);

        ShowDeleteConfirm = false;
    }

    private void CloseModal() => IsShowModal = false;

    private string GetBrandBadgeClass(string brand) => brand switch
    {
        "Apple" => "bg-dark text-white",
        "Samsung" => "bg-primary text-white",
        "Xiaomi" => "bg-warning text-dark",
        "Oppo" => "bg-success text-white",
        _ => "bg-secondary text-white"
    };
}